name: 🔁 Postman Integration Tests
 
on:
  push:
    branches:
      - Master  # ✅ lowercase
 
jobs:
  api-test:
    runs-on: ubuntu-latest
 
    steps:
      - name: ⬇️ Checkout Code
        uses: actions/checkout@v3
 
      - name: 🧪 Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
 
      - name: 📦 Install Backend Dependencies
        working-directory: backend
        run: npm install
 
      - name: 🟢 Start Backend Server with MongoDB URI
        working-directory: backend
        env:
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
        run: |
          npm run dev &  # Or replace with `npm start` if needed
          sleep 10       # Wait for server to boot
 
      - name: 🧪 Install Newman
        run: npm install -g newman
 
      - name: ✅ Run Postman Tests
        run: |
          newman run backend/src/test/survey-api-tests.json \
            --env-var "apiKey=${{ secrets.ADMIN_API_KEY }}" \
            --env-var "baseUrl=http://localhost:8000"
